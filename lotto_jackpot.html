<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° Lucky Jackpot Lotto</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: radial-gradient(ellipse at center, #1a0a2e 0%, #0a0015 100%);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 30px 20px 60px;
    font-family: 'Arial Black', sans-serif;
    overflow-x: hidden;
  }

  /* â”€â”€ ë„¤ì˜¨ íƒ€ì´í‹€ â”€â”€ */
  .neon-title {
    font-size: 3rem;
    font-weight: 900;
    letter-spacing: 6px;
    color: #fff;
    text-shadow:
      0 0 7px #fff,
      0 0 21px #fff,
      0 0 42px #ffd700,
      0 0 82px #ffd700,
      0 0 92px #ffd700;
    margin-bottom: 8px;
    text-align: center;
  }
  .sub-title {
    color: #ff69b4;
    font-size: 1rem;
    letter-spacing: 4px;
    text-shadow: 0 0 10px #ff69b4;
    margin-bottom: 30px;
    text-align: center;
  }

  /* â”€â”€ ì „êµ¬ ë°°ë„ˆ â”€â”€ */
  .bulb-row {
    display: flex;
    gap: 14px;
    margin-bottom: 20px;
  }
  .bulb {
    width: 14px; height: 14px;
    border-radius: 50%;
    background: #ffcc00;
    box-shadow: 0 0 10px #ffcc00, 0 0 20px #ffcc00;
    animation: bulb-blink 0.7s infinite alternate;
  }
  .bulb:nth-child(even) { animation-delay: 0.35s; background: #ff4444; box-shadow: 0 0 10px #ff4444, 0 0 20px #ff4444; }
  @keyframes bulb-blink {
    from { opacity: 0.3; }
    to   { opacity: 1; }
  }

  /* â”€â”€ ë¨¸ì‹  ë³¸ì²´ â”€â”€ */
  .machine-wrapper {
    display: flex;
    align-items: center;
    gap: 0;
    position: relative;
  }

  .machine-body {
    background: linear-gradient(160deg, #c0392b 0%, #8b0000 40%, #6b0000 100%);
    border: 6px solid #444;
    border-radius: 30px 30px 20px 20px;
    width: 480px;
    padding: 28px 28px 36px;
    box-shadow:
      inset 0 4px 20px rgba(255,255,255,0.1),
      0 20px 60px rgba(0,0,0,0.8),
      0 0 0 3px #ffd700,
      0 0 0 7px #444;
    position: relative;
  }

  /* ë¨¸ì‹  ìƒë‹¨ ì „êµ¬ ë  */
  .machine-top-bulbs {
    position: absolute;
    top: -18px;
    left: 20px; right: 20px;
    display: flex;
    justify-content: space-between;
  }
  .machine-top-bulbs .bulb {
    width: 16px; height: 16px;
  }

  /* ë¨¸ì‹  ë¡œê³  íŒ¨ë„ */
  .machine-logo {
    background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
    border: 3px solid #ffd700;
    border-radius: 12px;
    text-align: center;
    padding: 10px 0;
    margin-bottom: 18px;
    box-shadow: 0 0 20px rgba(255,215,0,0.4);
  }
  .machine-logo span {
    font-size: 1.6rem;
    font-weight: 900;
    letter-spacing: 4px;
    background: linear-gradient(to bottom, #fff3ad, #ffd700, #b8860b);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* â”€â”€ ìŠ¬ë¡¯ í™”ë©´ â”€â”€ */
  .slot-screen {
    background: #000;
    border: 4px solid #ffd700;
    border-radius: 14px;
    padding: 16px 10px;
    margin-bottom: 22px;
    box-shadow:
      inset 0 0 40px rgba(0,0,0,0.9),
      0 0 20px rgba(255,215,0,0.3);
    overflow: hidden;
    position: relative;
  }

  .slot-screen::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg,
      rgba(255,255,255,0.05) 0%,
      transparent 30%,
      transparent 70%,
      rgba(0,0,0,0.3) 100%);
    pointer-events: none;
    border-radius: 10px;
    z-index: 2;
  }

  .reels-row {
    display: flex;
    gap: 8px;
    justify-content: center;
  }

  .reel-window {
    flex: 1;
    height: 90px;
    overflow: hidden;
    border-radius: 8px;
    border: 2px solid #222;
    background: #0a0a0a;
    position: relative;
  }

  .reel-strip {
    display: flex;
    flex-direction: column;
    transition: none;
    position: absolute;
    width: 100%;
  }

  .reel-cell {
    height: 90px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.2rem;
    font-weight: 900;
    color: #f6e05e;
    text-shadow: 0 0 15px rgba(246,224,94,0.9), 0 0 30px rgba(246,224,94,0.5);
    font-variant-numeric: tabular-nums;
    flex-shrink: 0;
  }

  /* ìŠ¤ìº”ë¼ì¸ íš¨ê³¼ */
  .scan-line {
    position: absolute;
    left: 0; right: 0;
    height: 2px;
    background: rgba(255,255,255,0.05);
    animation: scan 3s linear infinite;
    z-index: 3;
    pointer-events: none;
  }
  @keyframes scan {
    from { top: 0; }
    to   { top: 100%; }
  }

  /* â”€â”€ í•˜ë‹¨ ì¥ì‹ íŒ¨ë„ â”€â”€ */
  .bottom-panel {
    background: linear-gradient(135deg, #111, #222);
    border: 2px solid #333;
    border-radius: 10px;
    padding: 12px;
    text-align: center;
    margin-bottom: 0;
  }
  .bottom-panel span {
    color: #ffd700;
    font-size: 0.85rem;
    letter-spacing: 3px;
    text-shadow: 0 0 8px #ffd700;
  }

  /* â”€â”€ ë ˆë²„ (ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œ) â”€â”€ */
  .lever-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-left: -6px;
    margin-top: 40px;
    cursor: pointer;
    user-select: none;
    position: relative;
    z-index: 10;
  }

  .lever-base {
    width: 36px;
    height: 160px;
    background: linear-gradient(90deg, #888, #ccc, #888);
    border-radius: 6px;
    border: 3px solid #555;
    position: relative;
    box-shadow: 4px 0 10px rgba(0,0,0,0.5);
    transition: none;
  }

  /* ë ˆë²„ ë§‰ëŒ€ (ì›€ì§ì´ëŠ” ë¶€ë¶„) */
  .lever-rod {
    width: 18px;
    height: 100px;
    background: linear-gradient(90deg, #aaa, #eee, #aaa);
    border-radius: 9px;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: 10px;
    transition: top 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    box-shadow: 2px 2px 6px rgba(0,0,0,0.4);
  }

  .lever-rod.pulled {
    top: 60px;
  }

  /* ë ˆë²„ ì†ì¡ì´ (ê³µ ëª¨ì–‘) */
  .lever-knob {
    width: 50px;
    height: 50px;
    background: radial-gradient(circle at 35% 35%, #ff6b6b, #c0392b, #7b0000);
    border-radius: 50%;
    border: 4px solid #ffd700;
    box-shadow:
      0 4px 8px rgba(0,0,0,0.6),
      0 0 20px rgba(255,100,100,0.5),
      inset 0 -3px 6px rgba(0,0,0,0.3);
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: -15px;
    transition: top 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .lever-knob.pulled {
    top: 68px;
  }

  /* ë ˆë²„ ë¼ë²¨ */
  .lever-label {
    margin-top: 10px;
    color: #ffd700;
    font-size: 0.65rem;
    letter-spacing: 2px;
    text-shadow: 0 0 6px #ffd700;
    writing-mode: vertical-rl;
    text-orientation: mixed;
    transform: rotate(180deg);
  }

  /* â”€â”€ ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ â”€â”€ */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.82);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
  }
  .modal-overlay.open {
    display: flex;
  }

  .modal-box {
    background: #1a1a2e;
    border: 3px solid #ffd700;
    border-radius: 20px;
    padding: 28px 28px 24px;
    width: min(780px, 96vw);
    max-height: 92vh;
    overflow-y: auto;
    box-shadow:
      0 0 0 6px #333,
      0 30px 80px rgba(0,0,0,0.9),
      0 0 40px rgba(255,215,0,0.2);
    position: relative;
    animation: modal-in 0.35s cubic-bezier(0.34,1.56,0.64,1) forwards;
  }
  @keyframes modal-in {
    from { opacity: 0; transform: scale(0.8) translateY(30px); }
    to   { opacity: 1; transform: scale(1)   translateY(0); }
  }

  .modal-title {
    text-align: center;
    color: #ffd700;
    font-size: 1.4rem;
    letter-spacing: 5px;
    text-shadow: 0 0 15px #ffd700;
    margin-bottom: 20px;
  }

  /* ë‹«ê¸° ë²„íŠ¼ */
  .modal-close {
    position: absolute;
    top: 14px; right: 18px;
    background: none;
    border: 2px solid #ffd700;
    border-radius: 50%;
    color: #ffd700;
    font-size: 1.1rem;
    width: 32px; height: 32px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.2s;
  }
  .modal-close:hover { background: #ffd700; color: #000; }

  /* í‹°ì¼“ ê·¸ë¦¬ë“œ: 2ì—´ */
  .tickets-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  /* 5ë²ˆì§¸ í‹°ì¼“ ê°€ìš´ë° ì •ë ¬ */
  .tickets-grid .ticket:nth-child(5) {
    grid-column: 1 / -1;
    max-width: 340px;
    margin: 0 auto;
    width: 100%;
  }

  /* â”€â”€ ë¡œë˜ í‹°ì¼“ (py ìŠ¤íƒ€ì¼) â”€â”€ */
  .ticket {
    background-color: #ffffff;
    border: 2px dashed #ccc;
    border-radius: 10px;
    padding: 20px;
    font-family: 'Courier New', monospace;
    text-align: center;
    box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
    color: #333;
    opacity: 0;
    transform: scale(0.9);
    transition: opacity 0.4s, transform 0.4s;
  }
  .ticket.show {
    opacity: 1;
    transform: scale(1);
  }

  .ticket-label {
    font-weight: bold;
    border-bottom: 1px solid #eee;
    margin-bottom: 12px;
    padding-bottom: 8px;
    font-size: 0.95rem;
    color: #555;
    letter-spacing: 1px;
  }

  .ticket-numbers {
    font-size: 1.5rem;
    color: #ff4b4b;
    font-weight: bold;
    letter-spacing: 3px;
    margin: 4px 0 12px;
  }

  .ticket-issued {
    font-size: 0.78rem;
    color: #999;
    margin-top: 4px;
  }

  /* ìµœê·¼ 100íšŒ HOT í‹°ì¼“ ê°•ì¡° */
  .ticket-hot {
    border-color: #ff4b4b;
    background: linear-gradient(135deg, #fff8f8 0%, #fff0f0 100%);
    box-shadow: 2px 2px 14px rgba(255, 75, 75, 0.25);
  }
  .hot-label {
    color: #d32f2f !important;
    border-bottom-color: #ffcdd2 !important;
  }

  /* â”€â”€ ëŒ€ë°• í”Œë˜ì‹œ íš¨ê³¼ â”€â”€ */
  .jackpot-flash {
    position: fixed;
    inset: 0;
    background: rgba(255,215,0,0.15);
    pointer-events: none;
    opacity: 0;
    z-index: 9999;
    animation: flash-anim 0.15s steps(1) forwards;
  }
  @keyframes flash-anim {
    0%   { opacity: 1; }
    50%  { opacity: 0; }
    100% { opacity: 0; }
  }

  /* ë°˜ì§ì´ íŒŒí‹°í´ */
  .confetti-piece {
    position: fixed;
    width: 10px; height: 10px;
    border-radius: 2px;
    animation: confetti-fall 2s ease-in forwards;
    pointer-events: none;
    z-index: 9998;
  }
  @keyframes confetti-fall {
    0%   { transform: translateY(-20px) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
  }

  /* ë ˆë²„ ë¹„í™œì„±í™” ìƒíƒœ */
  .lever-wrapper.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  /* ëª¨ë°”ì¼ ëŒ€ì‘ */
  @media (max-width: 560px) {
    .machine-body { width: 320px; padding: 18px 14px 24px; }
    .neon-title { font-size: 2rem; }
    .reel-cell { font-size: 1.6rem; }
    .reel-window { height: 70px; }
    .reel-cell { height: 70px; }
    .ball { width: 38px; height: 38px; font-size: 0.9rem; }
  }
</style>
</head>
<body>

<!-- ë„¤ì˜¨ íƒ€ì´í‹€ -->
<div class="neon-title">ğŸ° LUCKY JACKPOT</div>
<div class="sub-title">WINNER WINNER CHICKEN DINNER!</div>

<!-- ì „êµ¬ ë  -->
<div class="bulb-row" id="top-bulbs"></div>

<!-- ë¨¸ì‹  + ë ˆë²„ -->
<div class="machine-wrapper">

  <!-- ë¨¸ì‹  ë³¸ì²´ -->
  <div class="machine-body">
    <!-- ìƒë‹¨ ì „êµ¬ -->
    <div class="machine-top-bulbs" id="machine-bulbs"></div>

    <!-- ë¡œê³  íŒ¨ë„ -->
    <div class="machine-logo">
      <span>âœ¦ LOTTO JACKPOT âœ¦</span>
    </div>

    <!-- ìŠ¬ë¡¯ ë¦´ í™”ë©´ -->
    <div class="slot-screen">
      <div class="scan-line"></div>
      <div class="reels-row" id="reels-row">
        <!-- JSë¡œ ìƒì„± -->
      </div>
    </div>

    <!-- í•˜ë‹¨ íŒ¨ë„ -->
    <div class="bottom-panel">
      <span>â˜… INSERT COIN &amp; PULL LEVER â˜…</span>
    </div>
  </div>

  <!-- ë ˆë²„ -->
  <div class="lever-wrapper" id="lever" onclick="pullLever()">
    <div class="lever-base">
      <div class="lever-rod" id="lever-rod"></div>
      <div class="lever-knob" id="lever-knob"></div>
    </div>
    <div class="lever-label">PULL</div>
  </div>

</div>

<!-- íŒì—… ëª¨ë‹¬ -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModalDirect()">âœ•</button>
    <div class="modal-title">ğŸŸï¸ YOUR LUCKY TICKETS</div>
    <div id="stats-badge" style="text-align:center;font-size:0.72rem;color:#aaa;margin-bottom:14px;font-family:'Courier New',monospace;letter-spacing:1px;"></div>
    <div class="tickets-grid" id="tickets-container"></div>
  </div>
</div>

<script>
// â”€â”€ ì´ˆê¸°í™” â”€â”€
const NUM_REELS = 6;
let isSpinning = false;

// â”€â”€ ì—­ëŒ€ ë‹¹ì²¨ í†µê³„ (lotto_stats.json ë¡œë“œ) â”€â”€
let lottoWeights        = null;   // ì „ì²´ íšŒì°¨ ê°€ì¤‘ì¹˜ [{num, weight}, ...]
let lottoWeightsRecent  = null;   // ìµœê·¼ 100íšŒ ê°€ì¤‘ì¹˜
let lottoMeta           = null;   // {total_rounds, latest_round, ...}

function buildWeights(freqObj) {
  return Object.entries(freqObj).map(([num, cnt]) => ({
    num: parseInt(num),
    weight: cnt,
  }));
}

async function loadLottoStats() {
  try {
    const res = await fetch('lotto_stats.json');
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    lottoWeights       = buildWeights(data.freq);
    lottoWeightsRecent = buildWeights(data.freq_recent100);
    lottoMeta = {
      total_rounds:    data.total_rounds,
      latest_round:    data.latest_round,
      fetched_at:      data.fetched_at,
      recent100_start: data.recent100_start,
      recent100_end:   data.recent100_end,
    };
    console.log('[LottoStats] ë¡œë“œ ì™„ë£Œ:', lottoMeta);
  } catch (e) {
    console.warn('[LottoStats] ë¡œë“œ ì‹¤íŒ¨, ê· ë“± í™•ë¥  ì‚¬ìš©:', e);
    const uniform = Array.from({length: 45}, (_, i) => ({ num: i+1, weight: 1 }));
    lottoWeights       = uniform;
    lottoWeightsRecent = uniform;
  }
}

// â”€â”€ ê°€ì¤‘ ëœë¤ ì¶”ì¶œ (ë¹„ë³µì›) â”€â”€
// weights: [{num, weight}] ë°°ì—´ (ì›ë³¸ ìœ ì§€, ë‚´ë¶€ì—ì„œ ë³µì‚¬ë³¸ ì‚¬ìš©)
function weightedPick6(weights) {
  const pool = weights.map(w => ({ ...w }));  // ë³µì‚¬ë³¸
  const selected = [];
  for (let i = 0; i < 6; i++) {
    const totalW = pool.reduce((s, w) => s + w.weight, 0);
    let r = Math.random() * totalW;
    for (let j = 0; j < pool.length; j++) {
      r -= pool[j].weight;
      if (r <= 0) {
        selected.push(pool[j].num);
        pool.splice(j, 1);
        break;
      }
    }
  }
  return selected.sort((a, b) => a - b);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ í†µê³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
loadLottoStats();

// ì „êµ¬ ìƒì„±
const topBulbs = document.getElementById('top-bulbs');
for (let i = 0; i < 18; i++) {
  const b = document.createElement('div');
  b.className = 'bulb';
  b.style.animationDelay = (i * 0.08) + 's';
  topBulbs.appendChild(b);
}
const machineBulbs = document.getElementById('machine-bulbs');
for (let i = 0; i < 12; i++) {
  const b = document.createElement('div');
  b.className = 'bulb';
  b.style.width = '13px';
  b.style.height = '13px';
  b.style.animationDelay = (i * 0.1) + 's';
  machineBulbs.appendChild(b);
}

// ë¦´ ì´ˆê¸°í™”
const reelsRow = document.getElementById('reels-row');
const reelStrips = [];

for (let i = 0; i < NUM_REELS; i++) {
  const win = document.createElement('div');
  win.className = 'reel-window';

  const strip = document.createElement('div');
  strip.className = 'reel-strip';

  // ì´ˆê¸° ì…€ (ë¬¼ìŒí‘œ)
  const cell = document.createElement('div');
  cell.className = 'reel-cell';
  cell.textContent = '??';
  strip.appendChild(cell);

  win.appendChild(strip);
  reelsRow.appendChild(win);
  reelStrips.push({ strip, window: win });
}

// â”€â”€ ìœ í‹¸ â”€â”€
function randInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
function sleep(ms) {
  return new Promise(r => setTimeout(r, ms));
}
function pick6(useRecent = false) {
  const weights = useRecent ? lottoWeightsRecent : lottoWeights;
  if (weights) return weightedPick6(weights);
  // fallback: ê· ë“±
  const pool = Array.from({ length: 45 }, (_, i) => i + 1);
  const out = [];
  while (out.length < 6) {
    const idx = Math.floor(Math.random() * pool.length);
    out.push(pool.splice(idx, 1)[0]);
  }
  return out.sort((a, b) => a - b);
}

function ballClass(n) {
  if (n <= 10) return 'b1';
  if (n <= 20) return 'b2';
  if (n <= 30) return 'b3';
  if (n <= 40) return 'b4';
  return 'b5';
}

function pad2(n) { return String(n).padStart(2, '0'); }

// â”€â”€ ë¦´ ìŠ¤í•€ ì• ë‹ˆë©”ì´ì…˜ â”€â”€
async function spinReel(reelIdx, finalNum, totalDuration) {
  const { strip, window: win } = reelStrips[reelIdx];
  const cellHeight = win.offsetHeight; // 90px
  const startTime = performance.now();

  return new Promise(resolve => {
    let lastTime = startTime;
    let offset = 0;

    function frame(now) {
      const elapsed = now - startTime;
      const progress = Math.min(elapsed / totalDuration, 1);
      // easeOutCubic ê°ì†
      const eased = 1 - Math.pow(1 - progress, 3);
      // ì´ˆê¸° ì†ë„ â†’ ê°ì†
      const speed = cellHeight * 0.8 * (1 - eased * 0.95) + cellHeight * 0.02;
      const dt = now - lastTime;
      lastTime = now;
      offset += speed * (dt / 16);

      // ìƒˆ ëœë¤ ìˆ«ì ì…€ ì¶”ê°€
      while (offset >= cellHeight) {
        offset -= cellHeight;
        const cell = document.createElement('div');
        cell.className = 'reel-cell';
        // ë§ˆì§€ë§‰ í”„ë ˆì„ì´ë©´ ìµœì¢… ë²ˆí˜¸
        if (progress > 0.98) {
          cell.textContent = pad2(finalNum);
        } else {
          cell.textContent = pad2(randInt(1, 45));
        }
        strip.insertBefore(cell, strip.firstChild);
        // ì˜¤ë˜ëœ ì…€ ì œê±° (ë©”ëª¨ë¦¬)
        while (strip.children.length > 8) {
          strip.removeChild(strip.lastChild);
        }
      }

      strip.style.transform = `translateY(${offset - cellHeight}px)`;

      if (progress < 1) {
        requestAnimationFrame(frame);
      } else {
        // ìµœì¢… ìˆ«ìë¡œ ê³ ì •
        strip.innerHTML = '';
        const finalCell = document.createElement('div');
        finalCell.className = 'reel-cell';
        finalCell.textContent = pad2(finalNum);
        strip.appendChild(finalCell);
        strip.style.transform = 'translateY(0)';
        resolve();
      }
    }
    requestAnimationFrame(frame);
  });
}

// â”€â”€ ë ˆë²„ ë‹¹ê¸°ê¸° â”€â”€
async function pullLever() {
  if (isSpinning) return;
  isSpinning = true;

  const lever = document.getElementById('lever');
  const rod   = document.getElementById('lever-rod');
  const knob  = document.getElementById('lever-knob');
  lever.classList.add('disabled');

  // ë ˆë²„ ì•„ë˜ë¡œ
  rod.classList.add('pulled');
  knob.classList.add('pulled');

  await sleep(350);

  // ë ˆë²„ ë³µê·€
  rod.classList.remove('pulled');
  knob.classList.remove('pulled');

  // ëª¨ë‹¬ ì´ˆê¸°í™”
  document.getElementById('tickets-container').innerHTML = '';
  document.getElementById('modal-overlay').classList.remove('open');

  // ìŠ¬ë¡¯ ì´ˆê¸°í™”
  reelStrips.forEach(({ strip }) => {
    strip.innerHTML = '';
    const cell = document.createElement('div');
    cell.className = 'reel-cell';
    cell.textContent = '??';
    strip.appendChild(cell);
    strip.style.transform = 'translateY(0)';
  });

  // ìµœì¢… ë²ˆí˜¸ ìƒì„±
  const finalNums = pick6();

  // ë¦´ ìˆœì°¨ ìŠ¤í•€ (ë¦´ë§ˆë‹¤ ì•½ê°„ ë‹¤ë¥¸ ì‹œê°„)
  const promises = finalNums.map((num, i) => {
    const duration = 1800 + i * 400; // 1.8s ~ 3.8s
    return sleep(i * 150).then(() => spinReel(i, num, duration));
  });

  await Promise.all(promises);

  // í”Œë˜ì‹œ íš¨ê³¼
  spawnFlash();
  await sleep(200);
  spawnConfetti();

  // ëª¨ë‹¬ íŒì—…
  await sleep(400);
  await openModal();

  lever.classList.remove('disabled');
  isSpinning = false;
}

// â”€â”€ ëª¨ë‹¬ ì—´ê¸° + í‹°ì¼“ ë Œë”ë§ â”€â”€
async function openModal() {
  const container = document.getElementById('tickets-container');
  container.innerHTML = '';

  const now = new Date();
  const dateStr = now.getFullYear() + '/' +
    String(now.getMonth()+1).padStart(2,'0') + '/' +
    String(now.getDate()).padStart(2,'0') + ' ' +
    String(now.getHours()).padStart(2,'0') + ':' +
    String(now.getMinutes()).padStart(2,'0') + ':' +
    String(now.getSeconds()).padStart(2,'0');

  // í†µê³„ ë±ƒì§€ (ë¨¼ì € í‘œì‹œ)
  const badge = document.getElementById('stats-badge');
  if (lottoMeta) {
    badge.innerHTML =
      `â˜… 1~${lottoMeta.latest_round}íšŒ ì—­ëŒ€ ì¶œí˜„ í™•ë¥  ê¸°ë°˜ ì¶”ì²¨ â˜…<br>` +
      `<span style="color:#666;">(ê¸°ì¤€ì¼: ${lottoMeta.fetched_at})</span>`;
  } else {
    badge.innerHTML = 'â˜… ê· ë“± í™•ë¥  ì¶”ì²¨ (í†µê³„ ë°ì´í„° ì—†ìŒ) â˜…';
  }

  // í‹°ì¼“ 5ê°œ ìƒì„±
  // - #1,#2,#4,#5: ì „ì²´ íšŒì°¨ ê°€ì¤‘ í™•ë¥ 
  // - #3: ìµœê·¼ 100íšŒ ê°€ì¤‘ í™•ë¥  (HOT ë²ˆí˜¸ ê¸°ë°˜)
  const RECENT_IDX = 2; // 0-indexed â†’ 3ë²ˆì§¸ í‹°ì¼“
  const recentLabel = lottoMeta
    ? `${lottoMeta.recent100_start}~${lottoMeta.recent100_end}íšŒ HOT`
    : 'RECENT HOT';

  const tickets = [];
  for (let i = 0; i < 5; i++) {
    const isRecent = (i === RECENT_IDX);
    const nums   = pick6(isRecent);
    const numStr = nums.map(pad2).join('  ');
    const ticket = document.createElement('div');
    ticket.className = isRecent ? 'ticket ticket-hot' : 'ticket';
    ticket.innerHTML = isRecent
      ? `<div class="ticket-label hot-label">ğŸ”¥ ${recentLabel} ê¸°ë°˜</div>
         <div class="ticket-numbers">${numStr}</div>
         <div class="ticket-issued">ISSUED: ${dateStr}</div>`
      : `<div class="ticket-label">LUCKY TICKET #${i + 1}</div>
         <div class="ticket-numbers">${numStr}</div>
         <div class="ticket-issued">ISSUED: ${dateStr}</div>`;
    container.appendChild(ticket);
    tickets.push(ticket);
  }

  // ëª¨ë‹¬ ì˜¤í”ˆ
  document.getElementById('modal-overlay').classList.add('open');

  // í‹°ì¼“ ìˆœì°¨ ë“±ì¥
  for (let i = 0; i < tickets.length; i++) {
    await sleep(i === 0 ? 120 : 150);
    tickets[i].classList.add('show');
  }
}

function closeModal(e) {
  // ì˜¤ë²„ë ˆì´ ë°”ê¹¥(ë°°ê²½) í´ë¦­ ì‹œë§Œ ë‹«ê¸°
  if (e.target === document.getElementById('modal-overlay')) {
    document.getElementById('modal-overlay').classList.remove('open');
  }
}

function closeModalDirect() {
  document.getElementById('modal-overlay').classList.remove('open');
}

// â”€â”€ í”Œë˜ì‹œ â”€â”€
function spawnFlash() {
  const el = document.createElement('div');
  el.className = 'jackpot-flash';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 300);
}

// â”€â”€ ì»¨í˜í‹° â”€â”€
function spawnConfetti() {
  const colors = ['#ffd700','#ff4444','#44ff88','#44aaff','#ff44ff','#ffffff'];
  for (let i = 0; i < 80; i++) {
    const el = document.createElement('div');
    el.className = 'confetti-piece';
    el.style.left = Math.random() * 100 + 'vw';
    el.style.top = '-20px';
    el.style.background = colors[Math.floor(Math.random() * colors.length)];
    el.style.animationDelay = Math.random() * 1 + 's';
    el.style.animationDuration = (1.5 + Math.random() * 1.5) + 's';
    el.style.width = (6 + Math.random() * 8) + 'px';
    el.style.height = (6 + Math.random() * 8) + 'px';
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3500);
  }
}
</script>
</body>
</html>
