<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ° Lucky Jackpot Lotto</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: radial-gradient(ellipse at center, #12122a 0%, #05050f 100%);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 30px 20px 60px;
  font-family: 'Arial Black', sans-serif;
  overflow-x: hidden;
}

/* ë¨¸ì‹  scale ë˜í¼ */
.scene-wrapper {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  width: 100%;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë¨¸ì‹  ì™¸ë¶€ ì½”ì¸ ì¥ì‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.scene {
  position: relative;
  display: flex;
  align-items: center;
  filter: drop-shadow(0 40px 80px rgba(0,0,0,0.9));
}

/* ë°°ê²½ ì½”ì¸ (ì¥ì‹) */
.deco-coin {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 30%, #ffe566, #ffd700 40%, #b8860b 80%);
  border: 3px solid #daa520;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 900; color: #8b6400;
  box-shadow: 0 0 14px rgba(255,215,0,0.7), inset 0 2px 4px rgba(255,255,255,0.4);
  animation: coin-float 3s ease-in-out infinite;
  pointer-events: none;
}
@keyframes coin-float {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50%       { transform: translateY(-12px) rotate(8deg); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë¨¸ì‹  ë³¸ì²´
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.machine-body {
  background: linear-gradient(170deg, #2e2e2e 0%, #161616 45%, #1e1e1e 100%);
  border-radius: 28px 28px 18px 18px;
  width: 500px;
  padding: 0 0 28px;
  position: relative;
  /* 3ì¤‘ ê¸ˆ í…Œë‘ë¦¬ */
  box-shadow:
    0 0 0 4px #daa520,
    0 0 0 7px #111,
    0 0 0 11px #ffd700,
    0 0 0 14px #111,
    0 0 0 17px #b8860b,
    inset 0 2px 30px rgba(255,215,0,0.08),
    0 40px 100px rgba(0,0,0,0.95);
}

/* â”€â”€ JACKPOT ìƒë‹¨ ë°°ë„ˆ â”€â”€ */
.machine-top {
  background: linear-gradient(135deg, #5c3a00, #c8860a, #ffd700, #e8a800, #c8860a, #5c3a00);
  border-radius: 22px 22px 0 0;
  padding: 16px 32px 14px;
  text-align: center;
  border-bottom: 4px solid #111;
  position: relative;
  overflow: hidden;
}
.machine-top::before {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0.25) 0%, transparent 60%);
  border-radius: 22px 22px 0 0;
  pointer-events: none;
}
.jackpot-text {
  font-size: 2.6rem;
  font-weight: 900;
  letter-spacing: 10px;
  color: #111;
  text-shadow:
    0 1px 0 rgba(255,255,255,0.5),
    0 3px 6px rgba(0,0,0,0.5);
  position: relative;
}

/* ìƒë‹¨ ì „êµ¬ ì¤„ */
.top-bulbs {
  display: flex;
  justify-content: space-between;
  padding: 10px 20px 0;
}
.tbulb {
  width: 12px; height: 12px;
  border-radius: 50%;
  background: #ffcc00;
  box-shadow: 0 0 8px #ffcc00;
  animation: tb 0.6s infinite alternate;
}
.tbulb:nth-child(even) { background: #ff3300; box-shadow: 0 0 8px #ff3300; animation-delay: 0.3s; }
.tbulb:nth-child(3n)   { background: #fff; box-shadow: 0 0 8px #fff; animation-delay: 0.15s; }
@keyframes tb { from { opacity: 0.25; } to { opacity: 1; } }

/* â”€â”€ ë¨¸ì‹  ë‚´ë¶€ ì½˜í…ì¸  ì˜ì—­ â”€â”€ */
.machine-inner {
  padding: 20px 24px 0;
}

/* â”€â”€ ë¦´ í™”ë©´ í”„ë ˆì„ â”€â”€ */
.slot-frame {
  background: linear-gradient(135deg, #daa520, #ffd700, #b8860b);
  border-radius: 14px;
  padding: 5px;
  margin-bottom: 20px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.6), inset 0 1px 3px rgba(255,255,255,0.3);
}
.slot-screen {
  background: #000;
  border-radius: 10px;
  padding: 14px 10px;
  position: relative;
  overflow: hidden;
  box-shadow: inset 0 0 50px rgba(0,0,0,1);
}
/* CRT ê´‘ì„  íš¨ê³¼ */
.slot-screen::after {
  content: '';
  position: absolute; inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 3px,
    rgba(0,0,0,0.08) 3px,
    rgba(0,0,0,0.08) 4px
  );
  pointer-events: none;
  border-radius: 10px;
  z-index: 3;
}

.reels-row {
  display: flex;
  gap: 7px;
  justify-content: center;
  position: relative;
  z-index: 1;
}

.reel-window {
  flex: 1;
  height: 88px;
  overflow: hidden;
  border-radius: 6px;
  background: #050505;
  border: 2px solid #222;
  position: relative;
}
/* ë¦´ ìƒí•˜ ê·¸ë¼ë””ì–¸íŠ¸ ë§ˆìŠ¤í¬ */
.reel-window::before,
.reel-window::after {
  content: '';
  position: absolute;
  left: 0; right: 0;
  height: 28px;
  z-index: 2;
  pointer-events: none;
}
.reel-window::before { top: 0;    background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent); }
.reel-window::after  { bottom: 0; background: linear-gradient(to top,   rgba(0,0,0,0.9), transparent); }

.reel-strip {
  display: flex;
  flex-direction: column;
  position: absolute;
  width: 100%;
}

.reel-cell {
  height: 88px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: 900;
  color: #f0e0a0;
  text-shadow: 0 0 12px rgba(240,224,160,0.8);
  font-variant-numeric: tabular-nums;
  flex-shrink: 0;
  letter-spacing: -1px;
}

/* 777 ì­íŒŸ ì…€ */
.reel-seven {
  color: #ffd700 !important;
  font-size: 2.6rem !important;
  text-shadow:
    0 0 15px #ffd700,
    0 0 30px #ffa500,
    0 0 60px #ffd700 !important;
  animation: seven-pulse 0.25s ease-in-out infinite alternate;
}
@keyframes seven-pulse {
  from { transform: scale(1);    text-shadow: 0 0 15px #ffd700, 0 0 30px #ffa500; }
  to   { transform: scale(1.08); text-shadow: 0 0 25px #fff, 0 0 50px #ffd700, 0 0 80px #ffa500; }
}

/* â”€â”€ í•˜ë‹¨ ë²„íŠ¼ / íŒ¨ë„ â”€â”€ */
.machine-bottom {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  gap: 12px;
}

/* ë™ì „ íˆ¬ì…êµ¬ ì¥ì‹ */
.coin-slot {
  background: linear-gradient(135deg, #111, #2a2a2a);
  border: 2px solid #daa520;
  border-radius: 8px;
  width: 80px;
  height: 36px;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.55rem;
  color: #daa520;
  letter-spacing: 1px;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.5);
}

/* í¬ë ˆë”§ í‘œì‹œ */
.credit-display {
  background: #000;
  border: 2px solid #daa520;
  border-radius: 6px;
  padding: 4px 12px;
  font-family: 'Courier New', monospace;
  font-size: 0.7rem;
  color: #ff4400;
  letter-spacing: 2px;
  text-shadow: 0 0 8px #ff4400;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ë ˆë²„ (ì˜¤ë¥¸ìª½ ì†ì¡ì´)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.lever-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  user-select: none;
  position: relative;
  margin-left: -4px;
  padding-top: 30px;
}

/* ë ˆë²„ ê³ ì • ë² ì´ìŠ¤ (ê¸°ê³„ ë³¸ì²´ì— ë¶™ì€ ë¶€ë¶„) */
.lever-mount {
  width: 28px;
  height: 200px;
  background: linear-gradient(90deg, #555, #999, #777, #999, #555);
  border-radius: 6px;
  border: 2px solid #444;
  position: relative;
  box-shadow: 4px 0 12px rgba(0,0,0,0.6);
}

/* ì›€ì§ì´ëŠ” ë ˆë²„ ì•” */
.lever-arm {
  width: 14px;
  height: 120px;
  background: linear-gradient(90deg, #888, #ddd, #bbb, #ddd, #888);
  border-radius: 7px;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  top: 8px;
  transition: top 0.28s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-shadow: 2px 0 6px rgba(0,0,0,0.4);
  transform-origin: bottom center;
}
.lever-arm.pulled { top: 72px; }

/* ì†ì¡ì´ (ë¹¨ê°„ ê³µ) */
.lever-knob {
  width: 52px;
  height: 52px;
  background: radial-gradient(circle at 32% 28%, #ff8888, #e00000, #800000);
  border-radius: 50%;
  border: 4px solid #ffd700;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  top: -16px;
  transition: top 0.28s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-shadow:
    0 6px 14px rgba(0,0,0,0.7),
    0 0 20px rgba(220,0,0,0.5),
    inset 0 -4px 8px rgba(0,0,0,0.3),
    inset 0 4px 8px rgba(255,255,255,0.2);
}
.lever-knob.pulled { top: 76px; }

/* ë ˆë²„ ë¼ë²¨ */
.lever-label {
  margin-top: 10px;
  color: #ffd700;
  font-size: 0.6rem;
  letter-spacing: 3px;
  text-shadow: 0 0 6px #ffd700;
  writing-mode: vertical-rl;
  transform: rotate(180deg);
}

/* ë ˆë²„ ë¹„í™œì„±í™” */
.lever-wrapper.disabled { opacity: 0.5; pointer-events: none; }

/* í„°ì¹˜ ì˜ì—­ í™•ë³´ (ëª¨ë°”ì¼) */
.lever-wrapper { -webkit-tap-highlight-color: transparent; }
.lever-knob    { touch-action: manipulation; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   íŒì—… ëª¨ë‹¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  display: none;
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.85);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(5px);
}
.modal-overlay.open { display: flex; }

.modal-box {
  background: linear-gradient(160deg, #1a1a2e, #0d0d1a);
  border-radius: 20px;
  padding: 28px 28px 24px;
  width: min(780px, 96vw);
  max-height: 92vh;
  overflow-y: auto;
  position: relative;
  box-shadow:
    0 0 0 3px #daa520,
    0 0 0 6px #111,
    0 0 0 9px #ffd700,
    0 40px 100px rgba(0,0,0,0.95),
    0 0 60px rgba(255,215,0,0.15);
  animation: modal-in 0.38s cubic-bezier(0.34,1.56,0.64,1) forwards;
}
@keyframes modal-in {
  from { opacity: 0; transform: scale(0.75) translateY(30px); }
  to   { opacity: 1; transform: scale(1)   translateY(0); }
}

.modal-title {
  text-align: center;
  font-size: 1.5rem;
  font-weight: 900;
  letter-spacing: 5px;
  background: linear-gradient(to bottom, #ffe566, #ffd700, #b8860b);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 6px;
  filter: drop-shadow(0 0 8px rgba(255,215,0,0.5));
}

.modal-close {
  position: absolute; top: 14px; right: 18px;
  background: none;
  border: 2px solid #daa520;
  border-radius: 50%;
  color: #ffd700;
  font-size: 1rem;
  width: 32px; height: 32px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: background 0.2s;
}
.modal-close:hover { background: #ffd700; color: #000; }

/* í†µê³„ ë±ƒì§€ */
#stats-badge {
  text-align: center;
  font-size: 0.72rem;
  color: #888;
  margin-bottom: 16px;
  font-family: 'Courier New', monospace;
  letter-spacing: 1px;
}

/* í‹°ì¼“ ê·¸ë¦¬ë“œ */
.tickets-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}
.tickets-grid .ticket:nth-child(5) {
  grid-column: 1 / -1;
  max-width: 340px;
  margin: 0 auto;
  width: 100%;
}

/* ë¡œë˜ í‹°ì¼“ (py ìŠ¤íƒ€ì¼) */
.ticket {
  background-color: #ffffff;
  border: 2px dashed #ccc;
  border-radius: 10px;
  padding: 20px;
  font-family: 'Courier New', monospace;
  text-align: center;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.12);
  color: #333;
  opacity: 0;
  transform: scale(0.9);
  transition: opacity 0.4s, transform 0.4s;
}
.ticket.show { opacity: 1; transform: scale(1); }

.ticket-label {
  font-weight: bold;
  border-bottom: 1px solid #eee;
  margin-bottom: 12px;
  padding-bottom: 8px;
  font-size: 0.95rem;
  color: #555;
  letter-spacing: 1px;
}
.ticket-numbers {
  font-size: 1.5rem;
  color: #ff4b4b;
  font-weight: bold;
  letter-spacing: 3px;
  margin: 4px 0 12px;
}
.ticket-issued { font-size: 0.78rem; color: #999; margin-top: 4px; }

.ticket-hot {
  border-color: #ff4b4b;
  background: linear-gradient(135deg, #fff8f8, #fff0f0);
  box-shadow: 2px 2px 14px rgba(255,75,75,0.25);
}
.hot-label { color: #d32f2f !important; border-bottom-color: #ffcdd2 !important; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ì´í™íŠ¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* í”Œë˜ì‹œ */
.jackpot-flash {
  position: fixed; inset: 0;
  background: rgba(255,215,0,0.22);
  pointer-events: none;
  opacity: 0;
  z-index: 9999;
  animation: flash-anim 0.18s steps(1) forwards;
}
@keyframes flash-anim {
  0%   { opacity: 1; }
  50%  { opacity: 0; }
  100% { opacity: 0; }
}

/* ê¸ˆí™” ë¹„ */
.coin-rain {
  position: fixed;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 30%, #ffe566, #ffd700 40%, #b8860b 80%);
  border: 2px solid #daa520;
  box-shadow: 0 0 8px rgba(255,215,0,0.6);
  font-size: 12px; font-weight: 900; color: #8b6400;
  display: flex; align-items: center; justify-content: center;
  pointer-events: none;
  z-index: 9998;
  animation: coin-drop linear forwards;
}
@keyframes coin-drop {
  0%   { transform: translateY(-60px) rotate(0deg)   scale(1);   opacity: 1; }
  80%  { opacity: 1; }
  100% { transform: translateY(110vh) rotate(540deg) scale(0.6); opacity: 0; }
}

/* ì»¨í˜í‹° */
.confetti-piece {
  position: fixed;
  border-radius: 2px;
  animation: confetti-fall ease-in forwards;
  pointer-events: none;
  z-index: 9997;
}
@keyframes confetti-fall {
  0%   { transform: translateY(-20px) rotate(0deg);   opacity: 1; }
  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ëª¨ë°”ì¼ ë°˜ì‘í˜• (ëª¨ë‹¬/í‹°ì¼“)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 580px) {
  body { padding: 16px 8px 40px; }

  /* í‹°ì¼“ 1ì—´ */
  .tickets-grid {
    grid-template-columns: 1fr;
    gap: 10px;
  }
  .tickets-grid .ticket:nth-child(5) {
    grid-column: 1;
    max-width: none;
  }

  /* ëª¨ë‹¬ ì—¬ë°± ì¶•ì†Œ */
  .modal-box {
    padding: 20px 14px 16px;
    border-radius: 14px;
  }
  .modal-title {
    font-size: 1.1rem;
    letter-spacing: 2px;
  }
  #stats-badge { font-size: 0.65rem; }

  /* í‹°ì¼“ ë‚´ë¶€ */
  .ticket { padding: 14px 12px; }
  .ticket-label { font-size: 0.82rem; margin-bottom: 8px; padding-bottom: 6px; }
  .ticket-numbers { font-size: 1.15rem; letter-spacing: 1.5px; margin-bottom: 8px; }
  .ticket-issued { font-size: 0.7rem; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ í„°ì¹˜ ì˜ì—­ í™•ëŒ€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-close {
  min-width: 44px;
  min-height: 44px;
}

/* 777 í™”ë©´ í™©ê¸ˆ í…Œë‘ë¦¬ ê¸€ë¡œìš° */
.slot-frame.jackpot-glow {
  box-shadow:
    0 0 20px #ffd700,
    0 0 50px #ffa500,
    0 0 100px #ffd700,
    inset 0 0 20px rgba(255,215,0,0.2);
  animation: frame-glow 0.3s ease-in-out infinite alternate;
}
@keyframes frame-glow {
  from { box-shadow: 0 0 20px #ffd700, 0 0 50px #ffa500, inset 0 0 10px rgba(255,215,0,0.1); }
  to   { box-shadow: 0 0 40px #fff, 0 0 80px #ffd700, 0 0 120px #ffa500, inset 0 0 30px rgba(255,215,0,0.3); }
}
</style>
</head>
<body>

<div class="scene-wrapper">
<div class="scene" id="scene">

  <!-- ë°°ê²½ ì½”ì¸ ì¥ì‹ (JSë¡œ ì¶”ê°€) -->

  <!-- ë¨¸ì‹  ë³¸ì²´ -->
  <div class="machine-body">

    <!-- JACKPOT ë°°ë„ˆ -->
    <div class="machine-top">
      <div class="jackpot-text">JACKPOT</div>
    </div>

    <!-- ìƒë‹¨ ì „êµ¬ ì¤„ -->
    <div class="top-bulbs" id="top-bulbs"></div>

    <!-- ë¦´ í™”ë©´ -->
    <div class="machine-inner">
      <div class="slot-frame" id="slot-frame">
        <div class="slot-screen">
          <div class="reels-row" id="reels-row"></div>
        </div>
      </div>

      <!-- í•˜ë‹¨ íŒ¨ë„ -->
      <div class="machine-bottom">
        <div class="coin-slot">INSERT<br>COIN</div>
        <div class="credit-display" id="credit-display">CREDIT: 00</div>
        <div class="coin-slot">LUCKY<br>LOTTO</div>
      </div>
    </div>
  </div>

  <!-- ë ˆë²„ -->
  <div class="lever-wrapper" id="lever" onclick="pullLever()">
    <div class="lever-mount">
      <div class="lever-arm" id="lever-arm"></div>
      <div class="lever-knob" id="lever-knob"></div>
    </div>
    <div class="lever-label">PULL</div>
  </div>

</div>
</div><!-- /.scene-wrapper -->

<!-- íŒì—… ëª¨ë‹¬ -->
<div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModalDirect()">âœ•</button>
    <div class="modal-title">ğŸŸ YOUR LUCKY TICKETS</div>
    <div id="stats-badge"></div>
    <div class="tickets-grid" id="tickets-container"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì´ˆê¸°í™”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const NUM_REELS = 6;
let isSpinning = false;
let creditCount = 0;

// â”€â”€ ì—­ëŒ€ ë‹¹ì²¨ í†µê³„ â”€â”€
let lottoWeights       = null;
let lottoWeightsRecent = null;
let lottoMeta          = null;

function buildWeights(freqObj) {
  return Object.entries(freqObj).map(([num, cnt]) => ({
    num: parseInt(num), weight: cnt,
  }));
}

async function loadLottoStats() {
  try {
    const res = await fetch('lotto_stats.json');
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();
    lottoWeights       = buildWeights(data.freq);
    lottoWeightsRecent = buildWeights(data.freq_recent100);
    lottoMeta = {
      total_rounds:    data.total_rounds,
      latest_round:    data.latest_round,
      fetched_at:      data.fetched_at,
      recent100_start: data.recent100_start,
      recent100_end:   data.recent100_end,
    };
    console.log('[LottoStats] ë¡œë“œ ì™„ë£Œ:', lottoMeta);
  } catch (e) {
    console.warn('[LottoStats] ë¡œë“œ ì‹¤íŒ¨, ê· ë“± í™•ë¥  ì‚¬ìš©:', e);
    const uniform = Array.from({length:45}, (_,i) => ({num:i+1, weight:1}));
    lottoWeights = lottoWeightsRecent = uniform;
  }
}
loadLottoStats();

// â”€â”€ ì „êµ¬ ìƒì„± â”€â”€
const topBulbsEl = document.getElementById('top-bulbs');
for (let i = 0; i < 20; i++) {
  const b = document.createElement('div');
  b.className = 'tbulb';
  b.style.animationDelay = (i * 0.06) + 's';
  topBulbsEl.appendChild(b);
}

// â”€â”€ ë°°ê²½ ì½”ì¸ ì¥ì‹ ìƒì„± â”€â”€
const scene = document.getElementById('scene');
const coinPositions = [
  {w:48, top:'-30px',  left:'-80px',  delay:'0s',    dur:'3.2s'},
  {w:36, top:'20px',   left:'-120px', delay:'0.5s',  dur:'2.8s'},
  {w:56, top:'80px',   left:'-60px',  delay:'1.2s',  dur:'3.6s'},
  {w:42, top:'160px',  left:'-100px', delay:'0.8s',  dur:'2.5s'},
  {w:50, top:'240px',  left:'-75px',  delay:'1.8s',  dur:'3s'},
  {w:38, top:'300px',  left:'-110px', delay:'0.3s',  dur:'4s'},
  {w:48, top:'-30px',  right:'-80px', left:'auto', delay:'0.4s',  dur:'3s'},
  {w:36, top:'40px',   right:'-115px',left:'auto', delay:'1s',    dur:'2.6s'},
  {w:52, top:'100px',  right:'-55px', left:'auto', delay:'1.5s',  dur:'3.4s'},
  {w:40, top:'190px',  right:'-95px', left:'auto', delay:'0.7s',  dur:'2.9s'},
  {w:46, top:'260px',  right:'-70px', left:'auto', delay:'2s',    dur:'3.2s'},
  {w:34, top:'330px',  right:'-105px',left:'auto', delay:'0.1s',  dur:'3.8s'},
];
coinPositions.forEach(pos => {
  const c = document.createElement('div');
  c.className = 'deco-coin';
  c.textContent = '$';
  c.style.cssText = `
    width:${pos.w}px; height:${pos.w}px;
    top:${pos.top};
    ${pos.left !== 'auto' ? 'left:' + pos.left : 'right:' + pos.right};
    animation-delay:${pos.delay};
    animation-duration:${pos.dur};
    font-size:${Math.round(pos.w*0.28)}px;
  `;
  scene.appendChild(c);
});

// â”€â”€ ë¦´ ì´ˆê¸°í™” â”€â”€
const reelsRow   = document.getElementById('reels-row');
const reelStrips = [];
for (let i = 0; i < NUM_REELS; i++) {
  const win = document.createElement('div');
  win.className = 'reel-window';
  const strip = document.createElement('div');
  strip.className = 'reel-strip';
  const cell = document.createElement('div');
  cell.className = 'reel-cell';
  cell.textContent = '??';
  strip.appendChild(cell);
  win.appendChild(strip);
  reelsRow.appendChild(win);
  reelStrips.push({ strip, window: win });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ìœ í‹¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function randInt(min, max) { return Math.floor(Math.random() * (max-min+1)) + min; }
function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }
function pad2(n)   { return String(n).padStart(2, '0'); }

function weightedPick6(weights) {
  const pool = weights.map(w => ({...w}));
  const selected = [];
  for (let i = 0; i < 6; i++) {
    const totalW = pool.reduce((s, w) => s + w.weight, 0);
    let r = Math.random() * totalW;
    for (let j = 0; j < pool.length; j++) {
      r -= pool[j].weight;
      if (r <= 0) { selected.push(pool[j].num); pool.splice(j, 1); break; }
    }
  }
  return selected.sort((a,b) => a - b);
}

function pick6(useRecent = false) {
  const weights = useRecent ? lottoWeightsRecent : lottoWeights;
  if (weights) return weightedPick6(weights);
  const pool = Array.from({length:45}, (_,i) => i+1);
  const out = [];
  while (out.length < 6) { out.push(pool.splice(Math.floor(Math.random()*pool.length),1)[0]); }
  return out.sort((a,b)=>a-b);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë¦´ ìŠ¤í•€ ì• ë‹ˆë©”ì´ì…˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function spinReel(reelIdx, finalNum, totalDuration) {
  const { strip, window: win } = reelStrips[reelIdx];
  const cellH = win.offsetHeight;
  const startTime = performance.now();

  return new Promise(resolve => {
    let lastTime = startTime, offset = 0;

    function frame(now) {
      const elapsed  = now - startTime;
      const progress = Math.min(elapsed / totalDuration, 1);
      const eased    = 1 - Math.pow(1 - progress, 3);
      const speed    = cellH * 0.8 * (1 - eased * 0.95) + cellH * 0.02;
      const dt       = now - lastTime;
      lastTime = now;
      offset += speed * (dt / 16);

      while (offset >= cellH) {
        offset -= cellH;
        const cell = document.createElement('div');
        cell.className = 'reel-cell';
        cell.textContent = progress > 0.98 ? pad2(finalNum) : pad2(randInt(1, 45));
        strip.insertBefore(cell, strip.firstChild);
        while (strip.children.length > 8) strip.removeChild(strip.lastChild);
      }
      strip.style.transform = `translateY(${offset - cellH}px)`;

      if (progress < 1) {
        requestAnimationFrame(frame);
      } else {
        strip.innerHTML = '';
        const finalCell = document.createElement('div');
        finalCell.className = 'reel-cell';
        finalCell.textContent = pad2(finalNum);
        strip.appendChild(finalCell);
        strip.style.transform = 'translateY(0)';
        resolve();
      }
    }
    requestAnimationFrame(frame);
  });
}

// â”€â”€ 777777 í‘œì‹œ â”€â”€
function showSevens() {
  reelStrips.forEach(({ strip }) => {
    strip.innerHTML = '';
    const cell = document.createElement('div');
    cell.className = 'reel-cell reel-seven';
    cell.textContent = '7';
    strip.appendChild(cell);
    strip.style.transform = 'translateY(0)';
  });
  document.getElementById('slot-frame').classList.add('jackpot-glow');
}

function hideSevens() {
  document.getElementById('slot-frame').classList.remove('jackpot-glow');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë ˆë²„ ë‹¹ê¸°ê¸°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function pullLever() {
  if (isSpinning) return;
  isSpinning = true;

  const lever = document.getElementById('lever');
  const arm   = document.getElementById('lever-arm');
  const knob  = document.getElementById('lever-knob');
  lever.classList.add('disabled');

  // í¬ë ˆë”§ ì¹´ìš´íŠ¸
  creditCount++;
  document.getElementById('credit-display').textContent = `CREDIT: ${String(creditCount).padStart(2,'0')}`;

  // ë ˆë²„ ë‹¹ê¸°ê¸° ì• ë‹ˆë©”ì´ì…˜
  arm.classList.add('pulled');
  knob.classList.add('pulled');
  await sleep(300);
  arm.classList.remove('pulled');
  knob.classList.remove('pulled');

  // ì´ˆê¸°í™”
  document.getElementById('tickets-container').innerHTML = '';
  document.getElementById('modal-overlay').classList.remove('open');
  hideSevens();

  reelStrips.forEach(({ strip }) => {
    strip.innerHTML = '';
    const cell = document.createElement('div');
    cell.className = 'reel-cell';
    cell.textContent = '??';
    strip.appendChild(cell);
    strip.style.transform = 'translateY(0)';
  });

  // ìµœì¢… ë²ˆí˜¸ ìƒì„±
  const finalNums = pick6();

  // ë¦´ ìŠ¤í•€ (ìˆœì°¨ ì§€ì—°)
  const promises = finalNums.map((num, i) =>
    sleep(i * 160).then(() => spinReel(i, num, 1800 + i * 420))
  );
  await Promise.all(promises);

  // â˜… 777777 ì­íŒŸ ì—°ì¶œ â˜…
  showSevens();
  spawnFlash();
  await sleep(900);
  hideSevens();

  // ê¸ˆí™” ë¹„ + ì»¨í˜í‹°
  spawnCoinRain();
  spawnConfetti();

  // ëª¨ë‹¬ íŒì—…
  await sleep(400);
  await openModal();

  lever.classList.remove('disabled');
  isSpinning = false;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ëª¨ë‹¬ ì—´ê¸° + í‹°ì¼“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function openModal() {
  const container = document.getElementById('tickets-container');
  container.innerHTML = '';

  const now = new Date();
  const dateStr = now.getFullYear() + '/' +
    String(now.getMonth()+1).padStart(2,'0') + '/' +
    String(now.getDate()).padStart(2,'0') + ' ' +
    String(now.getHours()).padStart(2,'0') + ':' +
    String(now.getMinutes()).padStart(2,'0') + ':' +
    String(now.getSeconds()).padStart(2,'0');

  // í†µê³„ ë±ƒì§€
  const badge = document.getElementById('stats-badge');
  badge.innerHTML = lottoMeta
    ? `â˜… 1~${lottoMeta.latest_round}íšŒ ì—­ëŒ€ ì¶œí˜„ í™•ë¥  ê¸°ë°˜ ì¶”ì²¨ â˜…<br><span style="color:#555;">(ê¸°ì¤€ì¼: ${lottoMeta.fetched_at})</span>`
    : 'â˜… ê· ë“± í™•ë¥  ì¶”ì²¨ â˜…';

  // í‹°ì¼“ 5ê°œ (3ë²ˆì§¸ë§Œ ìµœê·¼ 100íšŒ HOT)
  const RECENT_IDX  = 2;
  const recentLabel = lottoMeta
    ? `${lottoMeta.recent100_start}~${lottoMeta.recent100_end}íšŒ HOT`
    : 'RECENT HOT';

  const tickets = [];
  for (let i = 0; i < 5; i++) {
    const isRecent = (i === RECENT_IDX);
    const nums     = pick6(isRecent);
    const numStr   = nums.map(pad2).join('  ');
    const ticket   = document.createElement('div');
    ticket.className = isRecent ? 'ticket ticket-hot' : 'ticket';
    ticket.innerHTML = isRecent
      ? `<div class="ticket-label hot-label">ğŸ”¥ ${recentLabel} ê¸°ë°˜</div>
         <div class="ticket-numbers">${numStr}</div>
         <div class="ticket-issued">ISSUED: ${dateStr}</div>`
      : `<div class="ticket-label">LUCKY TICKET #${i+1}</div>
         <div class="ticket-numbers">${numStr}</div>
         <div class="ticket-issued">ISSUED: ${dateStr}</div>`;
    container.appendChild(ticket);
    tickets.push(ticket);
  }

  document.getElementById('modal-overlay').classList.add('open');

  for (let i = 0; i < tickets.length; i++) {
    await sleep(i === 0 ? 120 : 160);
    tickets[i].classList.add('show');
  }
}

function closeModal(e) {
  if (e.target === document.getElementById('modal-overlay'))
    document.getElementById('modal-overlay').classList.remove('open');
}
function closeModalDirect() {
  document.getElementById('modal-overlay').classList.remove('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì´í™íŠ¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function spawnFlash() {
  const el = document.createElement('div');
  el.className = 'jackpot-flash';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 350);
}

function spawnCoinRain() {
  for (let i = 0; i < 50; i++) {
    const el = document.createElement('div');
    el.className = 'coin-rain';
    const size = 20 + Math.random() * 22;
    el.textContent = '$';
    el.style.cssText = `
      width:${size}px; height:${size}px;
      font-size:${size*0.38}px;
      left:${Math.random()*100}vw;
      top:-${40 + Math.random()*60}px;
      animation-duration:${1.2 + Math.random()*1.6}s;
      animation-delay:${Math.random()*1.2}s;
    `;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 4000);
  }
}

function spawnConfetti() {
  const colors = ['#ffd700','#ff4444','#44ff88','#44aaff','#ff44ff','#ffffff','#ffa500'];
  for (let i = 0; i < 70; i++) {
    const el = document.createElement('div');
    el.className = 'confetti-piece';
    const size = 6 + Math.random() * 8;
    el.style.cssText = `
      width:${size}px; height:${size}px;
      left:${Math.random()*100}vw;
      top:-20px;
      background:${colors[Math.floor(Math.random()*colors.length)]};
      animation-delay:${Math.random()*1.2}s;
      animation-duration:${1.5 + Math.random()*1.5}s;
    `;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 4000);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤ì¼€ì¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë¨¸ì‹ (500px) + í…Œë‘ë¦¬(34px) + ë ˆë²„(64px) + ì—¬ìœ  = ì•½ 620px
const SCENE_NATURAL_W = 620;

function applyMobileScale() {
  const scene = document.getElementById('scene');
  if (!scene) return;

  // ì‹¤ì œ viewport ë„ˆë¹„ (íŒ¨ë”© 16px ì œì™¸)
  const vw = Math.min(window.innerWidth, document.documentElement.clientWidth) - 16;

  if (vw < SCENE_NATURAL_W) {
    const scale = vw / SCENE_NATURAL_W;
    scene.style.transform       = `scale(${scale})`;
    scene.style.transformOrigin = 'top center';
    // scaleë¡œ ì¤„ì–´ë“  ë§Œí¼ ì•„ë˜ ì—¬ë°±ì´ ìƒê¸°ë¯€ë¡œ ìŒìˆ˜ marginìœ¼ë¡œ ë‹¹ê²¨ì¤Œ
    const naturalH = scene.getBoundingClientRect().height / scale;
    scene.style.marginBottom    = `${-(naturalH * (1 - scale))}px`;
  } else {
    scene.style.transform       = '';
    scene.style.transformOrigin = '';
    scene.style.marginBottom    = '';
  }
}

// ë°ì½” ì½”ì¸ì€ ëª¨ë°”ì¼ì—ì„œ clip ë°©ì§€ë¥¼ ìœ„í•´ scale ì´í›„ í‘œì‹œ
applyMobileScale();
window.addEventListener('resize', applyMobileScale);
</script>
</body>
</html>
